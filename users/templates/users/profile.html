{% extends 'main/base.html' %}

{% block content %}

{% if request.user.is_authenticated and user.username == profile.username and user.is_customer %}
    <div class="profile-details-header customer-details-header">
        <div class="header-content">
            <h1 class="full-name">
                <span class="profile-usher">name:</span> <span>{{profile.first_name}} </span><span>{{profile.last_name}}</span>
            </h1>
            <p class="username"><span class="profile-usher">Username:</span> {{profile.username}}</p>
            <p class="email"><span class="profile-usher">Email:</span> {{profile.email}}</p>
        </div>
    </div>

    <div class="services-header  services-header-profile">
        <h1>Previous Requested Services</h1>
    </div>

    <div class="services-grid">
        {% for requested_service in requested_services %}
        <a href="{% url 'index' requested_service.service.id %}" class="service-card">
            <div class="card-content">
                <p class="service-category">{{ requested_service.service.field }}</p>
                <h2 class="service-name">{{ requested_service.service }}</h2>
                <p class="service-price"><span>Total incured cost:</span> Kshs {{ requested_service.total_cost }}</p>
                <p class="service-date">requested on <span>{{requested_service.date}}</span></p>
                <p class="service-company">provided by {{requested_service.service.company}}</p>
            </div>
        </a>
        {% endfor %}
    </div>
{% else %}
    {% if profile.is_company %}
        <div class="profile-details-header">
            <div class="header-content">
                <h1 class="full-name">
                    <span class="profile-usher">name:</span> <span>{{profile.first_name}} </span><span>{{profile.last_name}}</span>
                </h1>
                <p class="username"><span class="profile-usher">Username:</span> {{profile.username}}</p>
                <p class="email"><span class="profile-usher">Email:</span> {{profile.email}}</p>
                <p class="field"><span class="profile-usher">Company type:</span> {{profile.company.field}}</p>
            </div>
        </div>

        <div class="services-header services-header-profile">
            <h1>{{profile.first_name}}'s Services</h1>
        </div>
        
        <div class="services-grid">
            {% for service in services %}
            <a href="{% url 'index' service.id %}" class="service-card">
                <div class="card-content">
                    <div class="service-category">{{ service.field }}</div>
                    <h2 class="service-name">{{ service.name }}</h2>
                    <div class="service-price">Kshs {{ service.price_hr }}</div>
                    <div class="service-company">by {{service.company}}</div>
                </div>
            </a>
            {% endfor %}
        </div>
    {% else %}
    <script>
        // redirect non-profile-owners to login after 5 seconds
        setTimeout(function () {
            window.location.href = "{% url 'login_user' %}"
        }, 1)
    </script>
    {% endif %}
{% endif %}
{% endblock content %}